{% extends "base.html" %}
{% block content %}
<h2>Current Program — {{ program.name }}</h2>

<!-- Deload controls -->
<div class="card">
  <!-- Post directly to the path to avoid endpoint naming issues -->
  <form method="post" action="/program/{{ program.id }}/deload" class="row gap" style="flex-wrap:wrap;">
    <label>Deload week</label>
    <select name="deload_week">
      {% for w in weeks %}
        <option value="{{ w }}" {% if program.deload_week == w %}selected{% endif %}>Week {{ w }}</option>
      {% endfor %}
    </select>
    <button class="btn" type="submit" name="action" value="set">Set deload</button>
    {% if program.deload_week %}
      <button class="btn danger" type="submit" name="action" value="clear">Clear deload</button>
    {% endif %}
  </form>
  {% if program.deload_week %}
    <div class="muted" style="margin-top:6px;font-size:13px;">
      Deload is scheduled for <strong>Week {{ program.deload_week }}</strong>.
    </div>
  {% endif %}
</div>

<!-- Week selector -->
<div class="card">
  <form method="get" class="row gap" style="flex-wrap:wrap;">
    <label>Week</label>
    <select name="week" onchange="this.form.submit()">
      {% for w in weeks %}
        <option value="{{ w }}" {% if w == current_week %}selected{% endif %}>Week {{ w }}</option>
      {% endfor %}
    </select>
    <noscript><button class="btn" type="submit">Go</button></noscript>
  </form>
</div>

<!-- Days (day_blocks is a list of tuples: (day, exercises)) -->
{% for day, exercises in day_blocks %}
  <div class="card">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <h3>{{ day.day_name }}</h3>
      <div class="row gap">
        <!-- Edit Day (use literal path) -->
        <a class="btn" href="/program/{{ program.id }}/day/{{ day.id }}/edit">Edit Day</a>

        <!-- Remove Day (POST form to literal path) -->
        <form method="post" action="/program/{{ program.id }}/day/{{ day.id }}/remove" style="display:inline;">
          <button class="btn danger" type="submit">Remove Day</button>
        </form>

        <!-- Log Day for the selected week (use literal path + query param) -->
        <a class="btn" href="/program/{{ program.id }}/day/{{ day.id }}/log?week={{ current_week }}">
          Log (Week {{ current_week }})
        </a>
      </div>
    </div>

    {% if exercises %}
      <ul style="margin:6px 0 0 20px;">
        {% for pe in exercises %}
          <li>
            {{ pe.exercise.name }} — {{ pe.sets }} sets @ {{ pe.rep_min }}–{{ pe.rep_max }} (RIR {{ pe.rir }})
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="muted" style="margin-top:6px;">No exercises added yet.</div>
    {% endif %}
  </div>
{% endfor %}

{% endblock %}
